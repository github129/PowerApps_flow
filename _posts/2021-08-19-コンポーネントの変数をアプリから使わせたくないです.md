---
layout: post
title: "コンポーネントの新機能「スコープ化」を使って変数をアプリから参照できなくする方法"
description: "このおかげで今までコンポーネント作成者はアプリを利用するユーザーを気にして変数や、コレクションを宣言しなければならなかったコストの削減や外部に影響を受けない安全なコンポーネントを作成できるようになりました。しかし、今までアプリからコンポーネントの変数を利用してきたアプリ作成者は一時的には設定で回避することはできますが、今後は何かしらのアップデートが必要になってくるでしょう。"
categories: [Power Apps, コンポーネント]
tags: [Power Apps, コンポーネント]
image: >-
  https://www.powerplatform.work/assets/img/thumbnail/2021-08-19.png
optimized_image: >-
  https://www.powerplatform.work/assets/img/thumbnail/2021-08-19.png
redirect_from:
  - /2021/08/17/
paginate: true
---

# 概要

Power Apps のキャンバスアプリの新機能として、コンポーネントの変数のスコープ化が登場しました。
この機能は今までコンポーネントで宣言した変数やコレクションはそのコンポーネントを利用しているアプリからも参照、利用することができたのですが、この機能を使うことでコンポーネント内のみで利用することができるようになる機能です。

このおかげで今までコンポーネント作成者はアプリを利用するユーザーを気にして変数や、コレクションを宣言しなければならなかったコストの削減や外部に影響を受けない安全なコンポーネントを作成できるようになりました。しかし、今までアプリからコンポーネントの変数を利用してきたアプリ作成者は一時的には設定で回避することはできますが、今後は何かしらのアップデートが必要になってくるでしょう。（この回避するための設定は一時的なもので今後利用できなくなる可能性があります。）


なおこの機能は 2021/8/19 現在は preview環境のみ利用できます。

## 動作確認

1. アプリ内で作成したコンポーネントを２つ用意。
2. それぞれ Set関数にて 「glbVar1」「glbVar2」を宣言。
3. glbVar1 はアクセスアプリスコープを オン に設定（回避）
4. glbVar2 はアクセスアプリスコープを オフ に設定（今後のデフォルト）
5. コンポーネント内とそれを利用したアプリでどのように表示されるかを確認。

以下のようにそれぞれ用意し、宣言しました。

glbVar1

<a class="post-image" href="/assets/blogpost/2021/2021-8-19-1.png">
<img itemprop="image" src="/assets/blogpost/2021/2021-8-19-1.png" alt="glbVar1" />
</a>
<br>

glbVar2

<a class="post-image" href="/assets/blogpost/2021/2021-8-19-2.png">
<img itemprop="image" src="/assets/blogpost/2021/2021-8-19-2.png" alt="glbVar2" />
</a>
<br>

それぞれアプリから利用すると以下のようになります。


<a class="post-image" href="/assets/blogpost/2021/2021-8-19-4.png">
<img itemprop="image" src="/assets/blogpost/2021/2021-8-19-4.png" alt="glbVar2" />
</a>
<br>

glbVar1 はアプリから参照ができ表示されていますが、 glbVar2はアプリから参照ができなくなっています。

また、この時点で、アプリ側で glbVar2 を宣言したらどうなるでしょうか？
結果は以下の通りです。

<a class="post-image" href="/assets/blogpost/2021/2021-8-19-5.png">
<img itemprop="image" src="/assets/blogpost/2021/2021-8-19-5.png" alt="glbVar2" />
</a>
<br>

アプリ内で宣言、利用されている変数のみに適用され、コンポーネント内の変数には影響は与えません。

また、glbVar1 を同じくアプリから宣言すると以下のようになります。

<a class="post-image" href="/assets/blogpost/2021/2021-8-19-6.png">
<img itemprop="image" src="/assets/blogpost/2021/2021-8-19-6.png" alt="glbVar2" />
</a>
<br>

コンポーネント内の変数にも影響を与えます。

この動作を利用して今まで少し変わったことをコンポーネントを通して行っていた場合、今後は利用できなくなります。

余談ですが、スコープの機能を利用するとコンポーネントの中にしか影響を与えないため、通常は不可能なコントロール名に変数名と同じ「glbVar2」を宣言することも可能です。

<a class="post-image" href="/assets/blogpost/2021/2021-8-19-3.png">
<img itemprop="image" src="/assets/blogpost/2021/2021-8-19-3.png" alt="glbVar2" />
</a>
<br>

なおコレクション等のほかの項目も同様の動きをします。




# まとめ

まとめると今回の設定では以下のような動作を行うようになります。

1. オンにすると、アプリ内からでもコンポーネント内の変数やコレクションを参照、操作することができます（今までの動作）
2. オフにすると、アプリ内から、コンポーネント内の変数やコレクションを参照、操作することができなくなります（これからの動作）

公式のブログはこちらになります。

[https://powerapps.microsoft.com/ja-jp/blog/canvas-components-can-now-access-app-scope-directly/](https://powerapps.microsoft.com/ja-jp/blog/canvas-components-can-now-access-app-scope-directly/)
